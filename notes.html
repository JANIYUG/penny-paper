<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Penny & Paper | Notes</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="app">

  <!-- SIDEBAR TOGGLE -->
  <input type="checkbox" id="sidebar-toggle">

  <!-- TOP NAV -->
  <header class="top-nav">
    <label for="sidebar-toggle" class="hamburger">☰</label>
    <nav>
      <a class="active">Notes</a>
    </nav>
  </header>

  <!-- CONTENT -->
  <div class="content">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <h2 class="logo">EXPENSE</h2>
      <nav>
        <a href="index.html">Home</a>
        <a href="add-expense.html">Add Expenses</a>
        <a href="r&p.html">Reports & Analysis</a>
        <a href="notes.html" class="active">Notes</a>
      </nav>
    </aside>

    <!-- MAIN -->
    <main class="main notes-main">

      <!-- NOTES HEADER -->
      <div class="notes-header">
        <h1>My Notes</h1>
        <div class="notes-actions">
          <input type="text" id="searchNotes" placeholder="Search notes..." oninput="filterNotes()">
          <button class="new-note-btn" onclick="createNewNote()">+ New Note</button>
        </div>
      </div>

      <!-- NOTES GRID -->
      <div class="notes-grid" id="notesGrid">
        <!-- Note cards will be inserted here -->
      </div>

      <!-- NOTE MODAL -->
      <div class="note-modal" id="noteModal" style="display: none;">
        <div class="note-modal-content">
          <div class="note-modal-header">
            <h2>Edit Note</h2>
            <button class="close-modal-btn" onclick="closeNoteModal()">&times;</button>
          </div>
          
          <div class="note-form">
            <input type="text" id="editorTitle" class="note-input-title" placeholder="Title">
            
            <!-- Reminder Fields (Always Visible) -->
            <div class="reminder-fields">
              <div class="reminder-row">
                <div class="reminder-field">
                  <label>Reminder Date</label>
                  <input type="date" id="reminderDate" class="reminder-input">
                </div>
                <div class="reminder-field">
                  <label>Time</label>
                  <input type="time" id="reminderTime" class="reminder-input">
                </div>
                <div class="reminder-field">
                  <label>Amount</label>
                  <input type="number" id="reminderAmount" class="reminder-input" placeholder="₹ 0">
                </div>
              </div>
            </div>
            
            <textarea id="editorBody" class="note-textarea" placeholder="Write your note here..."></textarea>
            
            <div class="note-modal-footer">
              <button class="delete-note-btn" onclick="deleteCurrentNote()">Delete</button>
              <button class="save-note-btn" onclick="saveAndCloseNote()">Save</button>
            </div>
          </div>
        </div>
      </div>

    </main>
  </div>
</div>

<script>
  let notes = JSON.parse(localStorage.getItem('expenseNotes')) || [];
  let currentNoteId = null;
  let autoSaveTimer = null;

  // Initialize
  document.addEventListener('DOMContentLoaded', function() {
    displayNotesGrid();
  });

  // Display notes as grid cards
  function displayNotesGrid() {
    const grid = document.getElementById('notesGrid');
    
    if (notes.length === 0) {
      grid.innerHTML = `
        <div class="no-notes">
          <h3>No notes yet</h3>
          <p>Click "+ New Note" to create your first note</p>
        </div>
      `;
      return;
    }

    // Sort: reminders first, then by date
    const sortedNotes = [...notes].sort((a, b) => {
      const aHasReminder = a.reminder && a.reminder.date;
      const bHasReminder = b.reminder && b.reminder.date;
      
      if (aHasReminder && !bHasReminder) return -1;
      if (!aHasReminder && bHasReminder) return 1;
      
      return new Date(b.lastModified) - new Date(a.lastModified);
    });

    grid.innerHTML = sortedNotes.map(note => {
      const preview = note.content.substring(0, 150);
      const hasReminder = note.reminder && note.reminder.date;
      const isUpcoming = hasReminder && isReminderUpcoming(note.reminder.date);
      
      return `
        <div class="note-card ${hasReminder ? 'has-reminder' : ''} ${isUpcoming ? 'upcoming' : ''}" onclick="openNoteModal(${note.id})">
          ${hasReminder ? `<div class="reminder-indicator">!</div>` : ''}
          <div class="note-card-header">
            <h3>${escapeHtml(note.title || 'Untitled')}</h3>
            <span class="note-date">${formatDate(note.lastModified)}</span>
          </div>
          ${hasReminder ? `
            <div class="note-reminder-info">
              <span class="reminder-badge">${formatReminderDate(note.reminder.date)}</span>
              ${note.reminder.time ? `<span class="reminder-time">${note.reminder.time}</span>` : ''}
              ${note.reminder.amount ? `<span class="reminder-amount">₹${note.reminder.amount}</span>` : ''}
            </div>
          ` : ''}
          <p class="note-card-preview">${escapeHtml(preview)}${note.content.length > 150 ? '...' : ''}</p>
        </div>
      `;
    }).join('');
  }

  function isReminderUpcoming(dateString) {
    const reminderDate = new Date(dateString);
    const now = new Date();
    const diffDays = Math.ceil((reminderDate - now) / (1000 * 60 * 60 * 24));
    return diffDays >= 0 && diffDays <= 7; // Upcoming within 7 days
  }

  function formatReminderDate(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diffMs = date - now;
    const diffDays = Math.ceil(diffMs / (1000 * 60 * 60 * 24));

    if (diffDays < 0) return 'Overdue';
    if (diffDays === 0) return 'Today';
    if (diffDays === 1) return 'Tomorrow';
    if (diffDays <= 7) return `In ${diffDays} days`;
    
    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
  }

  function createNewNote() {
    const newNote = {
      id: Date.now(),
      title: '',
      content: '',
      createdAt: new Date().toISOString(),
      lastModified: new Date().toISOString()
    };
    
    notes.unshift(newNote);
    localStorage.setItem('expenseNotes', JSON.stringify(notes));
    openNoteModal(newNote.id);
    
    // Focus on title
    setTimeout(() => {
      document.getElementById('editorTitle').focus();
    }, 100);
  }

  function openNoteModal(noteId) {
    const note = notes.find(n => n.id === noteId);
    if (!note) return;

    currentNoteId = noteId;

    // Show modal
    document.getElementById('noteModal').style.display = 'flex';

    // Load note content
    document.getElementById('editorTitle').value = note.title;
    document.getElementById('editorBody').value = note.content;

    // Load reminder if exists
    if (note.reminder) {
      document.getElementById('reminderDate').value = note.reminder.date || '';
      document.getElementById('reminderTime').value = note.reminder.time || '';
      document.getElementById('reminderAmount').value = note.reminder.amount || '';
    } else {
      document.getElementById('reminderDate').value = '';
      document.getElementById('reminderTime').value = '';
      document.getElementById('reminderAmount').value = '';
    }

    // Auto-save on input
    setupAutoSave();
  }

  function closeNoteModal() {
    saveCurrentNote();
    document.getElementById('noteModal').style.display = 'none';
    currentNoteId = null;
    displayNotesGrid();
  }

  function saveAndCloseNote() {
    saveCurrentNote();
    closeNoteModal();
  }

  function setupAutoSave() {
    const inputs = ['editorTitle', 'editorBody', 'reminderDate', 'reminderTime', 'reminderAmount'];
    
    inputs.forEach(id => {
      const element = document.getElementById(id);
      element.oninput = () => {
        clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(saveCurrentNote, 500);
      };
    });
  }

  function saveCurrentNote() {
    if (currentNoteId === null) return;

    const note = notes.find(n => n.id === currentNoteId);
    if (!note) return;

    const title = document.getElementById('editorTitle').value.trim();
    const content = document.getElementById('editorBody').value.trim();

    note.title = title || 'Untitled';
    note.content = content;
    note.lastModified = new Date().toISOString();

    // Save reminder if any field is filled
    const reminderDate = document.getElementById('reminderDate').value;
    const reminderTime = document.getElementById('reminderTime').value;
    const reminderAmount = document.getElementById('reminderAmount').value;

    if (reminderDate || reminderTime || reminderAmount) {
      note.reminder = {
        date: reminderDate,
        time: reminderTime,
        amount: reminderAmount
      };
    } else {
      delete note.reminder;
    }

    localStorage.setItem('expenseNotes', JSON.stringify(notes));
  }

  function deleteCurrentNote() {
    if (currentNoteId === null) return;
    
    if (!confirm('Delete this note?')) return;

    notes = notes.filter(n => n.id !== currentNoteId);
    localStorage.setItem('expenseNotes', JSON.stringify(notes));
    
    closeNoteModal();
  }

  function filterNotes() {
    const searchTerm = document.getElementById('searchNotes').value.toLowerCase();
    const noteCards = document.querySelectorAll('.note-card');
    
    noteCards.forEach(card => {
      const title = card.querySelector('h3').textContent.toLowerCase();
      const preview = card.querySelector('.note-card-preview').textContent.toLowerCase();
      
      if (title.includes(searchTerm) || preview.includes(searchTerm)) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
  }

  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  function formatDate(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diffMs = now - date;
    const diffDays = Math.floor(diffMs / 86400000);

    if (diffDays === 0) {
      return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
    } else if (diffDays === 1) {
      return 'Yesterday';
    } else if (diffDays < 7) {
      return date.toLocaleDateString('en-US', { weekday: 'short' });
    } else {
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }
  }
</script>

</body>
</html>
